<!DOCTYPE html>
<html>
  <head>
    <title>Pragmatic SBT</title>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="keywords" content="sbt, scala build tool">
    <meta name="description" content="A pragmatic introduction to SBT - the Scala Build Tool">

    <style type="text/css">
      @import url(https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz);
      @import url(https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic);
      @import url(https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic);

      body {
        font-family: 'Droid Serif';
      }
      h1, h2, h3 {
        font-family: 'Yanone Kaffeesatz';
        font-weight: 400;
        margin-bottom: 0;
      }
      .remark-slide-content h1 { font-size: 4em; }
      .remark-slide-content h2 { font-size: 2.5em; }
      .remark-slide-content h3 { font-size: 1.6em; }
      .footnote {
        position: absolute;
        bottom: 3em;
      }
      li p { line-height: 1.25em; }
      .red { color: #fa0000; }
      .large { font-size: 2em; }
      a, a > code {
        color: rgb(249, 38, 114);
        text-decoration: none;
      }
      code {
        background: #e7e8e2;
        border-radius: 5px;
      }
      .remark-code, .remark-inline-code { font-family: 'Ubuntu Mono'; }
      .remark-code-line-highlighted     { background-color: #373832; }
      .pull-left {
        float: left;
        width: 47%;
      }
      .pull-right {
        float: right;
        width: 47%;
      }
      .pull-right ~ p {
        clear: both;
      }
      #slideshow .slide .content code {
        font-size: 0.8em;
      }
      #slideshow .slide .content pre code {
        font-size: 0.9em;
        padding: 15px;
      }
      .inverse {
        background: #014908e1;
        color: #f3f3f3;
        text-shadow: 0 0 20px #333;
      }
      .inverse h1, .inverse h2 {
        color: #f3f3f3;
        line-height: 0.8em;
      }

      /* Slide-specific styling */
      #slide-inverse .footnote {
        bottom: 12px;
        left: 20px;
      }
      #slide-how .slides {
        font-size: 0.9em;
        position: absolute;
        top:  151px;
        right: 140px;
      }
      #slide-how .slides h3 {
        margin-top: 0.2em;
      }
      #slide-how .slides .first, #slide-how .slides .second {
        padding: 1px 20px;
        height: 90px;
        width: 120px;
        -moz-box-shadow: 0 0 10px #777;
        -webkit-box-shadow: 0 0 10px #777;
        box-shadow: 0 0 10px #777;
      }
      #slide-how .slides .first {
        background: #fff;
        position: absolute;
        top: 20%;
        left: 20%;
        z-index: 1;
      }
      #slide-how .slides .second {
        position: relative;
        background: #fff;
        z-index: 0;
      }

      /* Two-column layout */
      .left-column {
        color: #777;
        width: 20%;
        height: 92%;
        float: left;
      }
      .left-column h2:last-of-type, .left-column h3:last-child {
        color: #000;
      }
      .right-column {
        width: 75%;
        float: right;
        padding-top: 1em;
      }

      /* Two-column layout 50/50 */
      .left-column-50 {
        width: 49%;
        float: left;
      }
      .right-column-50 {
        width: 49%;
        float: right;
      }

      .tiny-font {
        font-size: 1em
      }

      .medium-font {
        font-size: 1.25em
      }

      .large-font {
        font-size: 1.5em
      }

      .xlarge-font {
        font-size: 1.75em
      }

      table {
        font-family: arial, sans-serif;
        border-collapse: collapse;
        width: 100%;
      }

      td, th {
        border: 1px solid #dddddd;
        text-align: left;
        padding: 8px;
      }

      tr:nth-child(odd) {
        background-color: #dddddd;
      }
    </style>
  </head>
  <body>

<textarea id="source">

name: main-template
layout: true
class: left, top
<!---
class: left, top, inverse
-->

---

class: center

<br/>
<br/>
<br/>
# Pragmatic SBT

<br/>
<br/>
<br/>
<br/>
### &copy; 2019 Hermann Hueck
<br/>
https://github.com/hermannhueck/pragmatic-sbt

---

# Abstract
<br/>

This presentation gives a pragmatic introduction to SBT - the Scala Build Tool -
in 7 examples. Each example is a build in it's own root directory: ./example??
Beginning with very simple sbt examples the later examples are becoming more
structured and more complex showing multi-project builds and cross version builds.

Recommended tutorial to start with sbt:

- https://www.scala-sbt.org/1.x/docs/sbt-by-example.html

---

# Agenda (1/2)
<br/>

1. [sbt without build file](#sbt_without_buildfile)
1. [sbt new](#sbt_new)
1. [Creating an application from the template](#create_application)
1. [Scala REPL](#scala_repl)
1. [Aliases](#aliases)
1. [Plugins](#plugins)
1. [Multi-project Builds](#multi_project_builds)
1. [Cross Builds](#cross_builds)
1. [Source code for different Scala versions](#source_code_for_different_scala_versions)
1. [Library Dependencies](#library_dependencies)
1. [Packaging](#packaging)
1. [Publishing](#publishing)
1. [Installable Packages with *sbt-native-packager*](#installable_packages)
1. [Settings and Tasks](#settings_tasks)
1. [Task Dependency Graph](#dependency_graph)
1. [Scopes](#scopes)
1. [TODO](#todo)
1. [References](#references)

---

class: middle, center
name: sbt_without_buildfile

# 1. sbt without build file
<br/>
<br/>
<br/>
<br/>
<br/>
&nbsp;

.footnote[
  &nbsp; &nbsp; &nbsp; *.../example01*
]

---

## No build file
<br/>

sbt uses the same kind of directory structure like Maven and Gradle.

We have a Scala/Java source structure in your root directory but no *build.sbt*.

```sh
example01 $ tree
.
└── src
    ├── main
    │   └── scala
    │       └── example
    │           └── HelloApp.scala
    └── test
        └── scala
            └── example
                └── HelloSpec.scala
```

--

<br/>
sbt provides a sensible default for every setting.

Hence you can use sbt with an empty *build.sbt* or even without *build.sbt* ...

---

## No build file

Start sbt and compile, run, test your code:

```sh
example01 $ sbt
[warn] No sbt.version set ...
[info] Loading settings ...
[info] Set current project to example01 ...
[info] sbt server started at ...
```
--
```sh
sbt:example01> scalaVersion
[info] 2.12.7
```
--
```sh
sbt:example01> compile
[info] Compiling 1 Scala source to .../example01/target/scala-2.12/classes ...
[info] Done compiling.
[success] Total time: 2 s, completed 01.07.2019 19:54:58
```
--
```sh
sbt:example01> run
[info] Packaging .../example01/target/scala-2.12/example01_2.12-0.1.0-SNAPSHOT.jar ...
[info] Done packaging.
[info] Running example.HelloApp 

Hello World!

[success] Total time: 0 s, completed 01.07.2019 19:55:07
```

---

## No build file

Add scalatest to libraryDependencies and test.

```sh
sbt:example01> test:compile
[info] Compiling 1 Scala source to .../example01/target/scala-2.12/test-classes ...
[error] .../example01/src/test/scala/example/HelloSpec.scala:3:12: object scalatest is not a member of package org
[error] import org.scalatest._
[error]            ^
```
--
```sh
sbt:example01> set libraryDependencies += "org.scalatest" %% "scalatest" % "3.0.8" % Test
[info] Defining libraryDependencies
[info] The new value will be used by allDependencies, dependencyPositions, dependencyUpdatesData
[info] Reapplying settings...
[info] Set current project to example01 (in build file:.../example01/)
```
--
```sh
sbt:example01> test:compile
[info] Compiling 1 Scala source to .../example01/target/scala-2.12/test-classes ...
[info] Done compiling.
```
--
```sh
sbt:example01> test
[info] HelloSpec:
[info] The HelloApp object
[info] - should say 'Hello World!'
[info] Run completed in 368 milliseconds.
[info] Total number of tests run: 1
[info] Suites: completed 1, aborted 0
[info] Tests: succeeded 1, failed 0, canceled 0, ignored 0, pending 0
[info] All tests passed.
[success] Total time: 3 s, completed 01.07.2019 19:58:08
```

---

## No build file

The '*save session*' command writes manually set settings to a minimal *build.sbt*.

```sh
sbt:example01> session save
[info] Reapplying settings...
[info] Set current project to example01 (in build file:.../example01/)
```
--
```sh
sbt:example01> exit
[info] shutting down server
```
--
```sh
example01 $ cat build.sbt 
libraryDependencies += "org.scalatest" %% "scalatest" % "3.0.8" % Test
```
--
```sh
example01 $ cat project/build.properties 
sbt.version=1.2.8
```

--

<br/>
###This is a possible but not the usual way to set up an sbt project.

---

class: middle, center
name: sbt_new

# 2. sbt new
<br/>
<br/>
<br/>
<br/>
<br/>
&nbsp;

.footnote[
  &nbsp; &nbsp; &nbsp; *.../example02*
]

---

<br/>
## sbt new [ gitter8-template ]
<br/>

quickly sets up a new sbt project using the specified gitter8 template.

<br/>
Many useful templates for different purposes can be found here:

https://github.com/foundweekends/giter8/wiki/giter8-templates

--

<br/>
### *scala/scala-seed.g8*

... a useful template for a simple project setup.

---

```sh
pragmatic-sbt $ sbt new scala/scala-seed.g8
[info] Set current project to ...

A minimal Scala project. 

name [Scala Seed Project]: example02

Template applied in .../example02
```
--
```sh
pragmatic-sbt $ cd example02
example02 $ tree
.
├── build.sbt
├── project
│   ├── Dependencies.scala
│   └── build.properties
└── src
    ├── main
    │   └── scala
    │       └── example
    │           └── Hello.scala
    └── test
        └── scala
            └── example
                └── HelloSpec.scala

8 directories, 5 files
```

---

### Generated files:

**project/build.properties**
```scala
sbt.version=1.2.8
```

--

**project/Dependencies.scala**
```scala
import sbt._

object Dependencies {
  lazy val scalaTest = "org.scalatest" %% "scalatest" % "3.0.8"
}
```

--

**build.sbt**
```scala
import Dependencies._

ThisBuild / scalaVersion     := "2.13.0"
ThisBuild / version          := "0.1.0-SNAPSHOT"
ThisBuild / organization     := "com.example"
ThisBuild / organizationName := "example"

lazy val root = (project in file("."))
  .settings(
    name := "example02",
    libraryDependencies += scalaTest % Test
  )
```

---

<br/>
## ThisBuild
<br/>

Settings in *ThisBuild* are the default settings for subprojects. This saves us from specifying
the settings repeatedly in different subprojects.

<br/>
A subproject can redefine any setting specified in *ThisBuild*.
---

class: middle, center
name: create_application

# 3. Creating an application from the template project
<br/>
<br/>
<br/>
<br/>
<br/>
&nbsp;

.footnote[
  &nbsp; &nbsp; &nbsp; *.../example03*
]

---

## Weather Application

The app queries the weather from https://www.metaweather.com/api/ using gigahorse-okhttp
as HTTP client and play-json to parse the JSON response.

--

```sh
example03 $ tree
.
├── build.sbt
├── project
│   ├── Dependencies.scala
│   └── build.properties
└── src
    ├── main
    │   └── scala
    │       ├── weather
    │       │   ├── Weather.scala
    │       │   └── WeatherApp.scala
    │       └── weather.sc
    └── test
        └── scala
            └── weather
                └── WeatherSpec.scala
```

---

### project/Dependencies.scala

```scala
import sbt._

object Dependencies {
  lazy val playJson = "com.typesafe.play" %% "play-json" % "2.7.3"
  lazy val okHttp = "com.eed3si9n" %% "gigahorse-okhttp" % "0.5.0"
  lazy val scalaTest = "org.scalatest" %% "scalatest" % "3.0.5"
}
```

--

### build.sbt

```scala
import Dependencies._

ThisBuild / scalaVersion     := "2.12.8"
ThisBuild / version          := "0.1.0"
ThisBuild / organization     := "com.example"
ThisBuild / organizationName := "example"

lazy val root = (project in file("."))
  .settings(
    name := "Example03",
    libraryDependencies ++= Seq(okHttp, playJson, scalaTest % Test)
  )
```

---

### src/main/scala/weather/WeatherLib.scala
(tested by: **src/test/scala/weather/WeatherSpec.scala**)

```scala
object WeatherLib {

  def weatherOf(locationName: String, longFormat: Boolean = false)
               (implicit ec: ExecutionContext): Future[String] = {
    ??? // some impl
  }
}
```

--

### src/main/scala/weather/WeatherApp.scala

```scala
object WeatherApp extends App {

  import WeatherLib._

  implicit val ec: ExecutionContext = ExecutionContext.global

  def showWeatherOf(location: String): String = {
    val weather = Await.result(weatherOf(location), 10.seconds)
    s"\nThe weather in $location is:   $weather\n"
  }

  println(showWeatherOf("Berlin"))
}
```

---

class: middle, center
name: scala_repl

# 4. Scala REPL
<br/>
<br/>
<br/>
<br/>
<br/>
&nbsp;

.footnote[
  &nbsp; &nbsp; &nbsp;  *.../example03*
]

---

The **console** command starts a Scala REPL from the sbt prompt
with the project dependencies and classes on the classpath.

The **initialCommands** setting in *build.sbt* initializes the REPL session -
typically used for the imports you need in every session of this project.

--

```scala
ThisBuild / initialCommands :=
  """
    |import scala.concurrent._
    |import scala.concurrent.duration._
    |import scala.concurrent.ExecutionContext.Implicits.global
    |import weather.WeatherLib._
    |""".stripMargin
```

--

```sh
sbt:Example03> console
[info] Starting scala interpreter...
Welcome to Scala 2.12.8 (Java HotSpot(TM) 64-Bit Server VM, Java 1.8.0_212).
Type in expressions for evaluation. Or try :help.

import scala.concurrent._
import scala.concurrent.duration._
import scala.concurrent.ExecutionContext.Implicits.global
import weather.WeatherLib._

scala> weatherOf("Berlin")
res0: scala.concurrent.Future[String] = Future(<not completed>)

scala> Await.result(res0, 10.seconds)
res1: String = showers
```

---

class: middle, center
name: aliases

# 5. Aliases
<br/>
<br/>
<br/>
<br/>
<br/>
&nbsp;

.footnote[
  &nbsp; &nbsp; &nbsp;  *.../example03*
]

---

<br/>
<br/>
Project specific aliases are defined in ...
### *[project_root].sbtrc*

--

<br/>
<br/>
User specific aliases (valid in all projects of this user) are defined in ...
### *~/.sbtrc*

--

<br/>
<br/>
```scala
alias a = alias
alias r = reload
alias c = compile
alias dl = dependencyList
```

---

<br/>
```sbt
sbt:Example03> a
	a = alias
	r = reload
	c = compile
	dl = dependencyList
```

--

```sbt
sbt:Example03> r
[info] Loading ...
[info] Set current project to Example03 (in build file:.../example03/)
```

--

```sh
sbt:Example03> c
[info] Compiling 2 Scala sources to .../example03/target/scala-2.12/classes ...
[info] Done compiling.
[success] Total time: 5 s, completed 02.07.2019 16:47:34
```

--

```sh
sbt:Example03> dl
[info] Updating ProjectRef(uri("file:.../example03/"), "root")...
[info] Done updating.
[warn] There may be incompatibilities among your library dependencies; run 'evicted' to see detailed eviction warnings.
[info] com.eed3si9n:gigahorse-core_2.12:0.5.0
[info] com.eed3si9n:gigahorse-okhttp_2.12:0.5.0
[info] com.example:example03_2.12:0.1.0
[info] com.fasterxml.jackson.core:jackson-annotations:2.9.8
[info] com.fasterxml.jackson.core:jackson-core:2.9.8
...
```

---

class: middle, center
name:  plugins

# 6.  Plugins
<br/>
<br/>
<br/>
<br/>
<br/>
&nbsp;

.footnote[
  &nbsp; &nbsp; &nbsp; *.../example03*
]

---

<br/>
<br/>
## Preinstalled Plugins
<br/>
<br/>
Some plugins are already installed and enabled in sbt.

The **plugins** command lists the currently installed plugins.

--

<br/>
```html
sbt:Example03> plugins
In file:.../example03/
	sbt.plugins.IvyPlugin: enabled in root
	sbt.plugins.JvmPlugin: enabled in root
	sbt.plugins.CorePlugin: enabled in root
	sbt.ScriptedPlugin
	sbt.plugins.SbtPlugin
	sbt.plugins.JUnitXmlReportPlugin: enabled in root
	sbt.plugins.Giter8TemplatePlugin: enabled in root
```

---

<br/>
<br/>
## User-installed Plugins
<br/>
<br/>

- Project specific plugins are installed in<br/>
**project/plugins.sbt**.

--

- User specific plugins (valid in all projects of this user) are installed in<br/>
**~/.sbt/1.0/plugins/plugins.sbt**.

<br/>
<br/>
<br/>
More details:<br/>
https://www.scala-sbt.org/1.x/docs/Community-Plugins.html

---

## Plugin: *sbt-updates*
<br/>

shows possible library dependency updates.

(This possibly saves you from looking up the latest versions of libraries on mvnrepository.com.)

Source code: https://github.com/rtimush/sbt-updates

--

### plugins.sbt
```scala
addSbtPlugin("com.timushev.sbt" % "sbt-updates" % "0.4.1")
```

--

<br/>
```sh
sbt:Example03> dependencyUpdates
[info] Found 3 dependency updates for example03
[info]   com.typesafe.play:play-json  : 2.7.3  -> 2.7.4          
[info]   org.scala-lang:scala-library : 2.12.8          -> 2.13.0
[info]   org.scalatest:scalatest:test : 3.0.5  -> 3.0.8          
[success] Total time: 0 s, completed 02.07.2019 13:17:11
```

---

## Plugin: *sbt-dependency-graph*

shows a tree of library dependencies.

Source code: https://github.com/jrudolph/sbt-dependency-graph

--

### plugins.sbt
```scala
addSbtPlugin("net.virtual-void" % "sbt-dependency-graph" % "0.9.2")
```

--

```sh
sbt:Example03> dependencyTree
[info] com.example:example03_2.12:0.1.0 [S]
[info]   +-com.eed3si9n:gigahorse-okhttp_2.12:0.5.0 [S]
[info]   | +-com.eed3si9n:gigahorse-core_2.12:0.5.0 [S]
[info]   | | +-com.typesafe:ssl-config-core_2.12:0.4.0 [S]
[info]   | | | +-com.typesafe:config:1.3.3
[info]   | | | +-org.scala-lang.modules:scala-parser-combinators_2.12:1.1.2 [S]
[info]   | | | 
[info]   | | +-org.reactivestreams:reactive-streams:1.0.2
[info]   | | +-org.slf4j:slf4j-api:1.7.26
[info]   | | 
[info]   | +-com.squareup.okhttp3:okhttp:3.14.2
[info]   |   +-com.squareup.okio:okio:1.17.2
[info]   |   
[info] ... // more dependencies
```

---

## Plugin: *sbt-sh*
<br/>

enables shell commands from the sbt prompt.

Source code: https://github.com/melezov/sbt-sh

--

### plugins.sbt
```scala
addSbtPlugin("com.oradian.sbt" % "sbt-sh" % "0.3.0")
```

--

<br/>
```sh
sbt:Example03> sh ls -l
total 8
-rw-r--r--  1 hermann  staff  367  1 Jul 15:55 build.sbt
drwxr-xr-x  6 hermann  staff  192  2 Jul 12:22 project
drwxr-xr-x  4 hermann  staff  128 30 Jun 23:04 src
drwxr-xr-x  6 hermann  staff  192  2 Jul 12:25 target
```

---

## Plugin: *sbt-git*

enables git commands from the sbt prompt.

Source code: https://github.com/sbt/sbt-git

--

### plugins.sbt
```scala
addSbtPlugin("com.typesafe.sbt" % "sbt-git" % "1.0.0")
```

--

```sh
sbt:Example03> git status
[info] Auf Branch master
[info] Ihr Branch ist auf demselben Stand wie 'origin/master'.
[info] Änderungen, die nicht zum Commit vorgemerkt sind:
[info]   (benutzen Sie "git add/rm <Datei>...", um die Änderungen zum Commit vorzumerken)
[info]   (benutzen Sie "git checkout -- <Datei>...", um die Änderungen im Arbeitsverzeichnis zu verwerfen)
[info] 	gelöscht:       src/main/scala/example/WeatherLib.scala
[info] 	gelöscht:       src/main/scala/example/WeatherApp.scala
[info] 	gelöscht:       src/test/scala/example/WeatherSpec.scala
[info] Unversionierte Dateien:
[info]   (benutzen Sie "git add <Datei>...", um die Änderungen zum Commit vorzumerken)
[info] 	src/test/scala/weather/
[info] keine Änderungen zum Commit vorgemerkt (benutzen Sie "git add" und/oder "git commit -a")
```

---

## Plugin: *sbt-coursier*
<br/>

alternative for the ivy dependency manager built into sbt.<br/>
Fetches dependency jars in parallel.

As of sbt 1.3.0 the need to install this plugin disappears.<br/>
Coursier will become the default dependency manager already built into sbt.

Web site: https://get-coursier.io/docs/sbt-coursier<br/>
Source code: https://github.com/coursier/coursier

--

### plugins.sbt
```scala
addSbtPlugin("io.get-coursier" % "sbt-coursier" % "1.1.0-M14-4")
```

---

## Plugin: *sbt-native-packager*

enables Java/Scala app packaging in different package formats:
zip, dmg (macOS), msi (Windows), deb and rpm (Linux) and docker etc.

Sie Chapter 11: [App Packaging](#app_packaging)

Web site: https://sbt-native-packager.readthedocs.io/en/stable/<br/>
Source code: https://github.com/sbt/sbt-native-packager

--

### project/plugins.sbt
```scala
addSbtPlugin("com.typesafe.sbt" % "sbt-native-packager" % "1.3.24")
```

### build.sbt
```scala
enablePlugin(JavaAppPackaging)
```

This plugin must explicitly be enabled in *build.sbt*.

---

class: middle

Having installed all these plugins our plugin list becomes somewhat longer:

```html
sbt:Example03> plugins
In file:.../example03/
	sbt.plugins.IvyPlugin: enabled in root
	sbt.plugins.JvmPlugin: enabled in root
	sbt.plugins.CorePlugin: enabled in root
	sbt.ScriptedPlugin
	sbt.plugins.SbtPlugin
	sbt.plugins.JUnitXmlReportPlugin: enabled in root
	sbt.plugins.Giter8TemplatePlugin: enabled in root
	coursier.sbtcoursier.CoursierPlugin: enabled in root
	coursier.sbtcoursiershared.SbtCoursierShared: enabled in root
	net.vonbuchholtz.sbt.dependencycheck.DependencyCheckPlugin: enabled in root
	com.typesafe.sbt.GitBranchPrompt
	com.typesafe.sbt.GitPlugin: enabled in root
	com.typesafe.sbt.GitVersioning
	com.timushev.sbt.updates.UpdatesPlugin: enabled in root
	com.oradian.sbt.SbtShPlugin: enabled in root
	net.virtualvoid.sbt.graph.DependencyGraphPlugin: enabled in root
```

--

This list is without *sbt-native-packager*.<br/>
This plugin bundle adds a lot more plugins, one for each package format.

---

class: middle, center
name: multi_project_builds

# 7. Multi-project Builds
<br/>
<br/>
<br/>
<br/>
<br/>
&nbsp;

.footnote[
  &nbsp; &nbsp; &nbsp; *.../example04*
]

---

## Multi-project Build

<br/>
In *example03* we kept all source code in one sbt project, the "root" project.
The *src* directory was located directly under the root directory of the build.

<br/>
Now we split the code into subprojects - "WeatherLib" and "WeatherApp" -
with their own project directories "lib" and "app". The third subproject "root"
does not have and does not need a "src" folder of its own. It is the over-arching
project which controls the other two.

--

<br/>
Subprojects are (if not specified otherwise) completely independent of each other.
I.e: Tasks can be executed in parallel.

<br/>
The subprojects have completed unrelated settings. If a setting is undefined in a subproject,
the default setting from *ThisBuild* is used.

--

<br/>
More details:<br/>
https://www.scala-sbt.org/1.x/docs/Multi-Project.html

---

### Directory tree

```sh
example04 $ tree
.
├── app
│   └── src
│       └── main
│           └── scala
│               └── app
│                   └── WeatherApp.scala
├── lib
│   └── src
│       ├── main
│       │   └── scala
│       │       └── libWeather
│       │           └── Weather.scala
│       └── test
│           └── scala
│               └── libWeather
│                   └── WeatherSpec.scala
├── build.sbt
└── project
    ├── Dependencies.scala
    └── build.properties
```

---

class: middle

### build.sbt

```scala
import Dependencies._

ThisBuild / scalaVersion     := "2.12.8"
ThisBuild / version          := "0.1.0"
ThisBuild / organization     := "com.example"
ThisBuild / organizationName := "example"

lazy val root = (project in file("."))
  .aggregate(app, lib)
  .settings(
    name := "Example04",
  )

lazy val app = (project in file("app"))
  .dependsOn(lib)
  .settings(
    name := "WeatherApp",
    initialCommands := """ ... // imports """.stripMargin,
  )

lazy val lib = (project in file("lib"))
  .settings(
    name := "WeatherLib",
    libraryDependencies ++= Seq(okHttp, playJson, scalaTest % Test)
  )
```

---

### .aggregate(...)

*root.aggregate(app, lib)* :
- Every command issued in "root" is propagated to "app" and "lib".
- e.g.: *compile* in "root" triggers *app/compile* and "lib/compile"
- *app/compile* and "lib/compile" could be executed in parallel if the subprojects do not depend on each other.

--

### .dependsOn(...)

*app.dependsOn(lib)* :
- "lib" is part of the classpath of "app".
- "lib must be updated and successfully compiled before "app" can be compiled (prevents parallel compilation).

--

### project specific sbt commands:

- **projects** &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lists the projects in the current build.

- **project [name]** &nbsp; &nbsp; triggers a switch of the current project.

---

```sh
sbt:Example04> projects
[info] In file:.../example04/
[info] 	   app
[info] 	   lib
[info] 	 * root
```
--
```sh
sbt:Example04> project lib
[info] Set current project to WeatherLib (in build file:.../example04/)
```
--
```sh
sbt:WeatherLib> projects
[info] In file:.../example04/
[info] 	   app
[info] 	 * lib
[info] 	   root
```
--
```html
sbt:WeatherLib> compile
[info] Compiling 1 Scala source to .../example04/lib/target/scala-2.12/classes ...
[info] Done compiling.
[success] Total time: 4 s, completed 02.07.2019 23:58:48
```
--
```sh
sbt:WeatherLib> project root
[info] Set current project to Example04 (in build file:.../example04/)
```
--
```html
sbt:Example04> compile
[info] Compiling 1 Scala source to .../example04/app/target/scala-2.12/classes ...
[info] Done compiling.
[success] Total time: 2 s, completed 02.07.2019 23:59:23
```

---

class: middle, center
name: cross_builds

# 8. Cross Builds
<br/>
<br/>
<br/>
<br/>
<br/>
&nbsp;

.footnote[
  &nbsp; &nbsp; &nbsp; *.../example05*
]

---

<br/>
## Cross-built libraries

<br/>
We already used cross-built libraries when specifying the *libraryDependencies*
with **%%** between group id and artefact id.

--

<br/>
```scala
libraryDependencies += "com.typesafe.play" %% "play-json" % "2.7.4"
```

This automatically appends the current *scalaVersion* to the artefact id.<br/>
E.g.: &nbsp; *play-json* becomes *play-json_2.13*.

---

```scala
import Dependencies._

val scala213 = "2.13.0"
val scala212 = "2.12.8"
val supportedScalaVersions = List(scala213, scala212)

ThisBuild / scalaVersion     := scala213
ThisBuild / version          := "0.1.0"
ThisBuild / organization     := "com.example"
ThisBuild / organizationName := "example"

lazy val root = (project in file("."))
  .aggregate(app, lib)
  .settings(
    name := "Example05",
    publish / skip := true,
    crossScalaVersions := Nil, // set to Nil on the aggregating project
  )

lazy val app = (project in file("app"))
  .dependsOn(lib)
  .settings(
    name := "WeatherApp",
    publish / skip := true,
    crossScalaVersions := supportedScalaVersions,
    initialCommands := """ ... // imports """.stripMargin,
  )

lazy val lib = (project in file("lib"))
  .settings(
    name := "WeatherLib",
    crossScalaVersions := supportedScalaVersions,
    libraryDependencies ++= Seq(okHttp, playJson, scalaTest % Test),
  )
```

---

## crossScalaVersions
<br/>

--

- *crossScalaVersions* is the setting to achive cross-building our source code to different binary Scala versions.

- It's value is a Seq of Strings, each containg a valid Scala version like "2.12.8" or "2.13.0".

--

- Skip cross-building in the overarching "root" project which has no source code.
  (Set *crossScalaVersions* to Nil and *publish/skip* to *true*.)

--

- The Scala version can be selected at the sbt prompt with the ++ command, e.g. *++2.12.8*

- If the ++ command is followed by a ! you can also switch to a Scala version
  not listed in *build.sbt*, e.g. *++2.11.12!*

--

- To build against all versions listed in crossScalaVersions,
  prefix the action to run with +, e.g. *+compile* or *+test*.

---

```html
sbt:Example05> scalaVersion
[info] app / scalaVersion
[info] 	2.13.0
[info] lib / scalaVersion
[info] 	2.13.0
[info] scalaVersion
[info] 	2.13.0
```

--

```html
sbt:Example05> compile
[info] Compiling 1 Scala source to .../example05/lib/target/scala-2.13/classes ...
[info] Done compiling.
[info] Compiling 1 Scala source to .../example05/app/target/scala-2.13/classes ...
[info] Done compiling.
[success] Total time: 5 s, completed 04.07.2019 12:39:09
```

--

```html
sbt:Example05> ++2.12.8 -v
[info] Setting Scala version to 2.12.8 on 2 projects.
[info] Switching Scala version on:
[info]     lib (2.12.8, 2.13.0)
[info]     app (2.12.8, 2.13.0)
[info] Excluding projects:
[info]   * root ()
[info] Reapplying settings...
[info] Set current project to Example05 (in build file:.../example05/)
```

---

```html
sbt:Example05> compile
[info] Compiling 1 Scala source to .../example05/lib/target/scala-2.12/classes ...
[info] Done compiling.
[info] Compiling 1 Scala source to .../example05/app/target/scala-2.12/classes ...
[info] Done compiling.
```

--

```html
sbt:Example05> clean
[success] Total time: 1 s, completed 04.07.2019 12:48:27
```

--

```html
sbt:Example05> +compile
[info] Setting Scala version to 2.13.0 on 2 projects.
[info] Excluded 1 projects, run ++ 2.13.0 -v for more details.
[info] Reapplying settings...
[info] Set current project to Example05 (in build file:.../example05/)
[info] Compiling 1 Scala source to .../example05/lib/target/scala-2.13/classes ...
[info] Done compiling.
[info] Compiling 1 Scala source to .../example05/app/target/scala-2.13/classes ...
[info] Done compiling.
[success] Total time: 4 s, completed 04.07.2019 12:48:37
[info] Setting Scala version to 2.12.8 on 2 projects.
[info] Excluded 1 projects, run ++ 2.12.8 -v for more details.
[info] Reapplying settings...
[info] Set current project to Example05 (in build file:.../example05/)
[info] Compiling 1 Scala source to .../example05/lib/target/scala-2.12/classes ...
[info] Done compiling.
[info] Compiling 1 Scala source to .../example05/app/target/scala-2.12/classes ...
[info] Done compiling.
[success] Total time: 5 s, completed 04.07.2019 12:48:43
[info] Reapplying settings...
[info] Set current project to Example05 (in build file:.../example05/)
```

---

```html
sbt:Example05> project lib
[info] Set current project to WeatherLib (in build file:.../example05/)
```

--

```html
sbt:WeatherLib> ++2.11.12! compile
[info] Forcing Scala version to 2.11.12 on all projects.
[info] Reapplying settings...
[info] Set current project to WeatherLib (in build file:.../example05/)
[info] Compiling 1 Scala source to .../example05/lib/target/scala-2.11/classes ...
[info] Done compiling.
[success] Total time: 2 s, completed 04.07.2019 13:15:44
```

--

The class files are compiled to version specific subdirectories of the *target* directories.

```sh
example05 $ tree lib/target/scala-*
lib/target/scala-2.11
└── classes
    └── libWeather
        └── *.class
lib/target/scala-2.12
└── classes
    └── libWeather
        └── *.class
lib/target/scala-2.13
└── classes
    └── libWeather
        └── *.class
```

---

<br/>
<br/>
<br/>
<br/>
### More info on cross-building:

<br/>
<br/>
https://www.scala-sbt.org/1.x/docs/Cross-Build.html

---

class: middle, center
name: source_code_for_different_scala_versions

# 9. Source code for different Scala versions
<br/>
<br/>
<br/>
<br/>
<br/>
&nbsp;

.footnote[
  &nbsp; &nbsp; &nbsp; *.../example06*
]

---

## Version specific code locations
<br/>

If you have source files for different Scala versions, place them into different
versions specific source directories, e.g.:

- *src/main/scala* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for code common to all Scala versions
- *src/main/scala-2.12* &nbsp; &nbsp; &nbsp; for code specific to Scala 2.12.x
- *src/main/scala-2.13* &nbsp; &nbsp; &nbsp; for code specific to Scala 2.13.x

--

```sh
example06 $ tree app/src
app/src
└── main
    ├── scala
    │   └── app
    │       └── WeatherBase.scala
    ├── scala-2.12
    │   └── app
    │       └── WeatherApp.scala
    └── scala-2.13
        └── app
            └── WeatherApp.scala
```

---

*src/main/scala/app/WeatherBase.scala*
```scala
class WeatherBase {
  import libWeather.Weather._
  implicit val ec: ExecutionContext = ExecutionContext.global

  def showWeatherOf(location: String): String = {
    val scalaVersion = util.Properties.versionString
    val weather = Await.result(weatherOf(location), 10.seconds)
    s"\nScala $scalaVersion:\nThe weather in $location is:   $weather\n"
  }
}
```

--

<br/>
*src/main/scala-2.12/app/WeatherApp.scala*
```scala
object WeatherApp extends WeatherBase with App {
  println(showWeatherOf("Berlin"))
}
```

--

<br/>
*src/main/scala-2.13/app/WeatherApp.scala*
```scala
object WeatherApp extends WeatherBase with App {
  import scala.util.chaining._
  showWeatherOf("Berlin") tap println
}
```

---

class: middle, center
name: library_dependencies

# 10. Library Dependencies
<br/>
<br/>
<br/>
<br/>
<br/>
&nbsp;

.footnote[
  &nbsp; &nbsp; &nbsp; *.../example07*
]

---

class: middle

## Unmanaged dependencies
<br>

Create a directory named ***lib*** under your subproject's root and put the jars you need into it.
sbt will add these jars to your subproject's classpath.

This way of adding library dependencies is very uncommon, but may be useful in some situations.

---

## Managed dependencies

This is the usual way to define dependencies. We used it already in the first example.

You have to specify the setting **libraryDependencies** which takes a *Seq[ModuleId]*.
Each *ModuleId* consists of a groupId, artefactId and revision joined with the %-operator
and optionally followed by a configuration such as *"test"* or *Test* (the type-safe way).

When using %% between groupId and artefactId sbt automatically detects the right binary
Scala version of the library from the current setting of ***scalaVersion***.

--

```scala
// gigahorse-okhttp for binary Scala version 2.12.x
libraryDependencies += "com.eed3si9n" % "gigahorse-okhttp_2.12" % "0.5.0"
```

--

```scala
// gigahorse-okhttp using the current scalaVersion setting
libraryDependencies += "com.eed3si9n" %% "gigahorse-okhttp" % "0.5.0"
```

--

<br/>
See also: https://www.scala-sbt.org/1.x/docs/Library-Dependencies.html

---

## Flexible Ivy revisions
<br/>

Ending the revision number with a + selects the latest available subrevision of a library.

```scala
// gigahorse-okhttp using the latest 0.5.x revision for the current scalaVersion
libraryDependencies += "com.eed3si9n" %% "gigahorse-okhttp" % "0.5.+"
```

--

<br/>
You may also specifiy *"latest.release"*, *"latest.milestone"* or *"latest.integration"*
instead of a revision number.

```scala
// depend on the latest avilable release of the gigahorse-okhttp module
libraryDependencies += "com.eed3si9n" %% "gigahorse-okhttp" % "latest.release"
```

```scala
// depend on the latest avilable integration (release or milestone) of the gigahorse-okhttp module
libraryDependencies += "com.eed3si9n" %% "gigahorse-okhttp" % "latest.integration"
```

--

<br/>
See also: https://ant.apache.org/ivy/history/2.3.0/ivyfile/dependency.html#revision

---

## Resolvers

Resolvers is a Seq of locations looked up by sbt when resolving library dependencies.

--

## Default Resolvers

Some resolvers are predefined by default. (Hence we don't need to define resolvers in many cases.)
- the Maven2 repository at *https://repo1.maven.org/maven2/*
- the local sbt cache at *~/.sbt/preloaded*
- jars published locally to Ivy at *~/.ivy/local
- the project resolver which resolves inter-project dependencies

The default resolvers can be listed in a quite weird format with<br/>
**show externalResolvers**

To change or remove the default resolvers, you would need to override **externalResolvers**.

---

## User-defined Resolvers

To add your own resolvers to the default ones, use the setting **resolvers**.<br/>
To add an additional repository, use

```sbt
resolvers += "name" at "location"
```

--

### Examples

```sbt
resolvers += "Local Maven Repository" at "file://"+Path.userHome.absolutePath+"/.m2/repository"
```

```sbt
resolvers += "Sonatype OSS Public" at "https://oss.sonatype.org/content/repositories/public"
```

```scala
// using a predefined shortcut for the "Sonatype public" repo
resolvers += Resolver.sonatypeRepo("public")
```

```sbt
resolvers += "Typesafe Releases" at "https://repo.typesafe.com/typesafe/releases"
```

```scala
// using a predefined shortcut for the "Typesafe releases" repo
resolvers += Resolver.typesafeRepo("releases")
```

---

class: middle

### More details on resolvers

<br/>
https://www.scala-sbt.org/1.x/docs/Resolvers.html

---

class: middle, center
name: packaging

# 11. Packaging
<br/>
<br/>
<br/>
<br/>
<br/>
&nbsp;

.footnote[
  &nbsp; &nbsp; &nbsp; *.../example07*
]

---

class: middle

## Commands for package generation
<br/>

sbt comes with some commands for the generation of packages (jar files).

- *packageBin* &nbsp; &nbsp; Produces a binary jar.
- *packageSrc* &nbsp; &nbsp; Produces a jar containing sources and resources.
- *packageDoc* &nbsp; &nbsp;Produces a jar containing API documentation.
- *package* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Is an alias for *packageBin*.

These commands generate jar files under<br/>
**[subproject_root]/target/scala-[scalaVersion]**

In a cross build project all commands can be prefixed with + in order to package jars
for all supported scala versions of the build.

---

```html
sbt:Example07> project lib
[info] Set current project to WeatherLib (in build file:.../example07/)
```
--
```html
sbt:WeatherLib> packageBin
[info] Packaging .../example07/lib/target/scala-2.13/weatherlib_2.13-0.1.0.jar ...
[info] Done packaging.
[success] Total time: 1 s, completed 05.07.2019 18:01:09
```
--
```html
sbt:WeatherLib> packageSrc
[info] Packaging .../example07/lib/target/scala-2.13/weatherlib_2.13-0.1.0-sources.jar ...
[info] Done packaging.
[success] Total time: 0 s, completed 05.07.2019 18:01:16
```
--
```html
sbt:WeatherLib> packageDoc
[info] Main Scala API documentation to .../example07/lib/target/scala-2.13/api...
model contains 3 documentable templates
[info] Main Scala API documentation successful.
[info] Packaging .../example07/lib/target/scala-2.13/weatherlib_2.13-0.1.0-javadoc.jar ...
[info] Done packaging.
[success] Total time: 1 s, completed 05.07.2019 18:01:25
```
--
```sh
example07 $ ls -1 lib/target/scala-2.13/*.jar
lib/target/scala-2.13/weatherlib_2.13-0.1.0-javadoc.jar
lib/target/scala-2.13/weatherlib_2.13-0.1.0-sources.jar
lib/target/scala-2.13/weatherlib_2.13-0.1.0.jar
```

---

class: middle, center
name: publishing

# 12. Publishing
<br/>
<br/>
<br/>
<br/>
<br/>
&nbsp;

.footnote[
  &nbsp; &nbsp; &nbsp; *.../example07*
]

---

class: middle

## Local Publishing
<br/>

- Using the command **publishLocal** you can publish a jar (typically a library jar) to the
local Ivy repository under **~/.ivy2/local**.

- Using the command **publishM2** you can publish a jar (typically a library jar) to the
local Maven2 repository under **~/.m2/repository**.

- **publishMavenStyle** is *true* (default) if the jars are published in Maven style (with a pom file)
or *false* if the Ivy style is used.

---

<br/>
<br/>
<br/>
<br/>

```html
sbt:Example07> project lib
[info] Set current project to WeatherLib (in build file:.../example07/)
```
--
```html
sbt:WeatherLib> publishMavenStyle
[info] true
```
--
```html
sbt:WeatherLib> publishLocal
[info] Writing Ivy file .../example07/lib/target/scala-2.13/resolution-cache/com.example/weatherlib_2.13/0.1.0/resolved.xml.xml
[info] Wrote .../example07/lib/target/scala-2.13/weatherlib_2.13-0.1.0.pom
[info] :: delivering :: com.example#weatherlib_2.13;0.1.0 :: 0.1.0 :: release :: Fri Jul 05 19:38:22 CEST 2019
[info] 	delivering ivy file to .../example07/lib/target/scala-2.13/ivy-0.1.0.xml
[info] 	published weatherlib_2.13 to ~/.ivy2/local/com.example/weatherlib_2.13/0.1.0/poms/weatherlib_2.13.pom
[info] 	published weatherlib_2.13 to ~/.ivy2/local/com.example/weatherlib_2.13/0.1.0/jars/weatherlib_2.13.jar
[info] 	published weatherlib_2.13 to ~/.ivy2/local/com.example/weatherlib_2.13/0.1.0/srcs/weatherlib_2.13-sources.jar
[info] 	published weatherlib_2.13 to ~/.ivy2/local/com.example/weatherlib_2.13/0.1.0/docs/weatherlib_2.13-javadoc.jar
[info] 	published ivy to ~/.ivy2/local/com.example/weatherlib_2.13/0.1.0/ivys/ivy.xml
[success] Total time: 1 s, completed 05.07.2019 19:38:23
```

---

class: middle

## Publishing to a resolver (ie.e to a remote repo)
<br/>

To publish a jar to a remote repo (in Maven style or in Ivy style) ...

- define the resolver (the destination to publish to) with the **publishTo** setting
- add the credentials for that resolver to the **credentials** setting
- (or alternatively and preferably - load the credentials from a properties file)
- run the **publish** command

<br/>
For examples and more details see:<br/>
https://www.scala-sbt.org/1.x/docs/Publishing.html

---

## What to publish?

Publishing makes only sense for libraries, not for applications.

To prevent a subproject from being published add the setting:<br/>
**publish / skip := true**

--

```scala
...
lazy val root = (project in file("."))
  .aggregate(app, lib)
  .settings(
    name := "Example05",
    publish / skip := true, // no code to publish
    ...
  )
lazy val app = (project in file("app"))
  .dependsOn(lib)
  .settings(
    name := "WeatherApp",
    publish / skip := true, // no need to publish the app
    ...
  )
lazy val lib = (project in file("lib"))
  .settings(
    name := "WeatherLib",
    // don't skip publishing in the library project
    ...
  )
```

---

class: middle, center
name: installable_packages

# 13. Installable Packages
# with *sbt-native-packager*
<br/>
<br/>
<br/>
<br/>
<br/>
&nbsp;

.footnote[
  &nbsp; &nbsp; &nbsp; *.../example08*
]

---

class: middle

## Library or App?
<br/>

If you write a library you have to publish it to a public repo
so that others can use it as a library dependency.

This can be done with sbt without additional plugin.

--

If you write an application you have to generate a installable package in the format
of the intended destination system, e.g. a Debian package for Debian or Ubuntu Linux
or an MSI package for Windows or a Docker image or some other installable format.

The **sbt-native-packager** plugin allows you to create a software distribution
of an application in any format.

---

class: middle

## Enable JavaAppPackaging
<br/>

### project/plugins.sbt
```scala
addSbtPlugin("com.typesafe.sbt" % "sbt-native-packager" % "1.3.24")
```

### build.sbt
```scala
lazy val app = (project in file("app"))
  .dependsOn(lib)
  .enablePlugins(JavaAppPackaging)
  .settings( ... )
```

The plugin must be enabled for the project you want to package.

---

## Staging

The **stage** command creates a local directory ( *.../target/universal/stage* )
with all the files laid out as they would be in the final distribution.

--

```html
sbt:Example08> project app
[info] Set current project to WeatherApp (in build file:.../example08/)
sbt:WeatherApp> stage
[info] Packaging ...
...
```

--

```sh
example08 $ tree app/target/universal/stage
app/target/universal/stage
├── bin
│   ├── weatherapp
│   └── weatherapp.bat
└── lib
    ├── com.eed3si9n.gigahorse-core_2.13-0.5.0.jar
    ├── com.eed3si9n.gigahorse-okhttp_2.13-0.5.0.jar
    ├── com.example.weatherapp-0.1.0.jar
    ├── com.example.weatherlib-0.1.0.jar
    ├── com.fasterxml.jackson.core.jackson-annotations-2.9.8.jar
    ├── ...
    └── org.slf4j.slf4j-api-1.7.26.jar
```

---

<br/>
<br/>
<br/>

*bin/weatherapp* can start the application on Mac and Linux.<br/>
*bin/weatherapp.bat* can start the application on Windows.
<br/>
<br/>

```sh
example08 $ app/target/universal/stage/bin/weatherapp 

Scala version 2.13.0:
The weather in Berlin is:   light rain

example08 $
```

---

## Zip distribution

The **universal:packageBin** command creates a zip file containg all the files staged.
The same can be achieved with a simple **dist** command.

--

```html
sbt:WeatherApp> universal:packageBin
[info] ...
[info] Your package is ready in .../example08/app/target/universal/weatherapp-0.1.0.zip
[success] Total time: 2 s, completed 06.07.2019 00:33:12
```

--

```sh
example08 $ unzip -l app/target/universal/weatherapp-0.1.0.zip 
Archive:  app/target/universal/weatherapp-0.1.0.zip
  Length      Date    Time    Name
---------  ---------- -----   ----
     5007  07-06-2019 00:16   weatherapp-0.1.0/lib/com.example.weatherapp-0.1.0.jar
     6357  07-05-2019 23:22   weatherapp-0.1.0/lib/com.example.weatherlib-0.1.0.jar
    33391  12-16-2018 00:06   weatherapp-0.1.0/lib/com.fasterxml.jackson.datatype.jackson-datatype-jdk8-2.9.8.jar
    42704  06-19-2019 02:15   weatherapp-0.1.0/lib/com.eed3si9n.gigahorse-okhttp_2.13-0.5.0.jar
   160144  06-19-2019 02:15   weatherapp-0.1.0/lib/com.eed3si9n.gigahorse-core_2.13-0.5.0.jar
   425763  05-19-2019 19:38   weatherapp-0.1.0/lib/com.squareup.okhttp3.okhttp-3.14.2.jar
           ...
   726698  06-12-2019 12:45   weatherapp-0.1.0/lib/com.typesafe.play.play-json_2.13-2.7.4.jar
    10567  07-06-2019 00:33   weatherapp-0.1.0/bin/weatherapp
     6317  07-06-2019 00:33   weatherapp-0.1.0/bin/weatherapp.bat
---------                     -------
 14304396                     23 files
```

---

## Gzipped tarball distribution

The **universal:packageZipTarball** command creates a tgz file containg all the files staged.

--

```html
sbt:WeatherApp> universal:packageZipTarball
[info] ...
Making /var/folders/.../weatherapp-0.1.0/bin/weatherapp executable
Making /var/folders/.../weatherapp-0.1.0/bin/weatherapp.bat executable
Running with tar -pcvf /var/folders/zg/1y5syxvj0mb5v3v0p0m8mhnc0000gn/T/sbt_68ba81f2/weatherapp-0.1.0.tar weatherapp-0.1.0
a weatherapp-0.1.0
a weatherapp-0.1.0/bin
a weatherapp-0.1.0/lib
a weatherapp-0.1.0/lib/com.squareup.okio.okio-1.17.2.jar
...
a weatherapp-0.1.0/bin/weatherapp
a weatherapp-0.1.0/bin/weatherapp.bat
[success] Total time: 1 s, completed 06.07.2019 17:27:55
```

--

```sh
example08 $ unzip -l app/target/universal/weatherapp-0.1.0.zip 
HermannMBP:example08 hermann$ tar -tzf app/target/universal/weatherapp-0.1.0.tgz 
weatherapp-0.1.0/
weatherapp-0.1.0/bin/
weatherapp-0.1.0/lib/
weatherapp-0.1.0/lib/com.squareup.okio.okio-1.17.2.jar
...
weatherapp-0.1.0/bin/weatherapp
weatherapp-0.1.0/bin/weatherapp.bat
```

---

## OSX DMG distribution

The **universal:packageOsxDmg** command creates a dmg file for macOS.

--

```html
sbt:WeatherApp> universal:packageOsxDmg
[info] ...
created: .../example08/app/target/universal/weatherapp-0.1.0.dmg
/dev/disk3          	GUID_partition_scheme          	
/dev/disk3s1        	Apple_HFS                      	.../example08/app/target/universal/dmg/weatherapp-0.1.0
"disk3" ejected.
[success] Total time: 2 s, completed 06.07.2019 00:52:29
```

--

```sh
example08 $ hdiutil mount app/target/universal/weatherapp-0.1.0.dmg
/dev/disk3          	GUID_partition_scheme          	
/dev/disk3s1        	Apple_HFS                      	/Volumes/weatherapp-0.1.0

example08 $ tree /Volumes/weatherapp-0.1.0
/Volumes/weatherapp-0.1.0
├── bin
│   ├── weatherapp
│   └── weatherapp.bat
└── lib
    ├── com.eed3si9n.gigahorse-okhttp_2.13-0.5.0.jar
    ├── com.example.weatherapp-0.1.0.jar
    ├── com.example.weatherlib-0.1.0.jar
    ├── ...
```

---

## Dockerize the App

The command **docker:publishLocal** creates a docker image with the app.

--

```html
sbt:WeatherApp> docker:publishLocal
...
[info] Sending build context to Docker daemon  14.33MB
[info] Step 1/15 : FROM openjdk:8 as stage0
[info]  ---> b8d3f94869bb
...
[info] Step 15/15 : CMD []
[info]  ---> Running in a1e6517b25a4
[info] Removing intermediate container a1e6517b25a4
[info]  ---> 96d21665e894
[info] Successfully built 96d21665e894
[info] Successfully tagged weatherapp:0.1.0
[info] Built image weatherapp with tags [0.1.0]
[success] Total time: 10 s, completed 06.07.2019 01:29:03
```

--

```sh
example08 $ docker run weatherapp:0.1.0

Scala version 2.13.0:
The weather in Berlin is:   light rain

example08 $```

---

<br/>
<br/>
<br/>
<br/>
**sbt-native-packager** supports many more archetypes and formats.

These examples used the *JavaAppPackaging* archtype (for simple CLI applications)
For Java server apps you shold use the *JavaServerAppPackaging* archtype.

--

<br/>
The general idea is "native packaging". I.e. create a Windows package on a Windows system,
create a Debian package on a Debian based Linux system (Debian or Ubuntu), an RPM package
on Redhat or SuSE Linux and a DMG package on a Mac.

--

<br/>
For more information read the docs at:

https://sbt-native-packager.readthedocs.io/

---

class: middle, center
name: settings_tasks

# 14. Settings and Tasks
<br/>
<br/>
<br/>
<br/>
<br/>
&nbsp;

.footnote[
  &nbsp; &nbsp; &nbsp; *.../example04*
]

---

class: middle, center
name: dependency_graph

# 15. Task Dependency Graph
<br/>
<br/>
<br/>
<br/>
<br/>
&nbsp;

.footnote[
  &nbsp; &nbsp; &nbsp; *.../example04*
]

---

class: middle, center
name: scopes

# 16. Scopes
<br/>
<br/>
<br/>
<br/>
<br/>
&nbsp;

.footnote[
  &nbsp; &nbsp; &nbsp; *.../example04*
]

---

class: middle, center
name: references

# 17. References
<br/>
<br/>
<br/>
<br/>
<br/>
&nbsp;

---

## References

- Code and Slides of this Talk:<br/>
  https://github.com/hermannhueck/pragmatic-sbt

- sbt Reference Manual<br/>
  https://www.scala-sbt.org/1.x/docs/index.html

- sbt Native Packager Docs<br/>
  https://www.scala-sbt.org/1.x/docs/index.html

- gitter8 templates for sbt<br/>
  https://github.com/foundweekends/giter8/wiki/giter8-templates

- sbt Community Plugins<br/>
  https://www.scala-sbt.org/release/docs/Community-Plugins.html

- sbt core concepts<br/>
  Talk by Eugene Yokota at Scala Days Lausanne 2019<br/>
  https://portal.klewel.com/watch/webcast/scala-days-2019/talk/15/

- sbt-native-packager - package all the things<br/>
  Talk by Nepomuk Seiler at Scala Days Berlin 2018<br/>
  https://www.youtube.com/watch?v=ID-EqTOgwKY

---

class: middle, center

# Thank You
<br/>
<br/>
<br/>

# Q &amp; A
<br/>
<br/>
<br/>
<br/>
<br/>

https://github.com/hermannhueck/pragmatic-sbt


</textarea>

    <script src="remark-latest.min.js" type="text/javascript">
    </script>
    <script type="text/javascript">
      var slideshow = remark.create({
        // sourceUrl: 'some-source.md',

        // Set the slideshow display ratio
        // Default: '4:3'
        // Alternatives: '16:9', ...
        ratio: '4:3',

        // Navigation options
        navigation: {
          // Enable or disable navigating using scroll
          // Default: true
          // Alternatives: false
          scroll: false,

          // Enable or disable navigation using touch
          // Default: true
          // Alternatives: false
          touch: true,

          // Enable or disable navigation using click
          // Default: false
          // Alternatives: true
          click: false
        },

        // Enable or disable counting of incremental slides in the slide counting
        countIncrementalSlides: true
      });
    </script>
  </body>
</html>
